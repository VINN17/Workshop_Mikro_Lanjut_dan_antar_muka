<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Komunikasi SPI Master-Slave</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .nav-btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .nav-btn.active {
            background: #2a5298;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .content {
            padding: 40px;
        }
        
        .slide {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .slide.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        h2 {
            color: #1e3c72;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        h3 {
            color: #2a5298;
            font-size: 1.5em;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        
        .info-box {
            background: #f8f9fa;
            border-left: 5px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .protocol-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .protocol-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .protocol-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .protocol-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .protocol-table tr:hover {
            background: #e9ecef;
        }
        
        .code-block {
            background: #282c34;
            color: #abb2bf;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .code-block .keyword {
            color: #c678dd;
        }
        
        .code-block .function {
            color: #61afef;
        }
        
        .code-block .string {
            color: #98c379;
        }
        
        .code-block .number {
            color: #d19a66;
        }
        
        .code-block .comment {
            color: #5c6370;
            font-style: italic;
        }
        
        .diagram {
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
        }
        
        .flow-box {
            display: inline-block;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 8px;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .box-pc {
            background: #ff6b6b;
            color: white;
        }
        
        .box-master {
            background: #4ecdc4;
            color: white;
        }
        
        .box-slave {
            background: #45b7d1;
            color: white;
        }
        
        .arrow {
            font-size: 2em;
            color: #667eea;
            margin: 0 10px;
        }
        
        .packet-diagram {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 5px;
            margin: 20px 0;
        }
        
        .packet-byte {
            padding: 15px;
            border: 2px solid #667eea;
            border-radius: 5px;
            min-width: 80px;
            text-align: center;
            background: white;
        }
        
        .packet-byte .label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .packet-byte .value {
            font-weight: bold;
            color: #1e3c72;
            font-family: monospace;
        }
        
        .highlight {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
        }
        
        .state-machine {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .state {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .timing-diagram {
            background: white;
            padding: 20px;
            border: 2px solid #667eea;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .timeline {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }
        
        .timeline-label {
            min-width: 150px;
            font-weight: 600;
            color: #1e3c72;
        }
        
        .timeline-bar {
            flex: 1;
            height: 30px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 600;
        }
        
        ul {
            margin: 15px 0;
            padding-left: 30px;
        }
        
        li {
            margin: 10px 0;
            line-height: 1.6;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .feature-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .feature-card h4 {
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            border-top: 2px solid #dee2e6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîå Sistem Komunikasi SPI Master-Slave</h1>
            <p>Arsitektur Komunikasi Multi-Slave dengan Protocol Custom</p>
        </div>
        
        <div class="nav-buttons">
            <button class="nav-btn active" onclick="showSlide(0)">Overview</button>
            <button class="nav-btn" onclick="showSlide(1)">Arsitektur</button>
            <button class="nav-btn" onclick="showSlide(2)">Protocol SPI</button>
            <button class="nav-btn" onclick="showSlide(3)">Format Paket</button>
            <button class="nav-btn" onclick="showSlide(4)">State Machine</button>
            <button class="nav-btn" onclick="showSlide(5)">Alur Data</button>
            <button class="nav-btn" onclick="showSlide(6)">Command & Response</button>
            <button class="nav-btn" onclick="showSlide(7)">PC Interface</button>
            <button class="nav-btn" onclick="showSlide(8)">Optimasi</button>
        </div>
        
        <div class="content">
            <!-- Slide 0: Overview -->
            <div class="slide active">
                <h2>üìã Overview Sistem</h2>
                
                <div class="info-box">
                    <h3>üéØ Tujuan Sistem</h3>
                    <p>Sistem ini adalah implementasi komunikasi <strong>Master-Multi Slave</strong> menggunakan protokol <strong>SPI (Serial Peripheral Interface)</strong> dengan custom protocol layer untuk komunikasi yang reliable dan terstruktur.</p>
                </div>
                
                <h3>üîß Komponen Utama</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>üíª PC (Computer)</h4>
                        <p>Mengirim command melalui Serial UART untuk request data dari slave tertentu</p>
                    </div>
                    <div class="feature-card">
                        <h4>üéõÔ∏è Master Arduino</h4>
                        <p>Mengontrol komunikasi SPI, mengelola 3 slave, display LCD, dan EEPROM storage</p>
                    </div>
                    <div class="feature-card">
                        <h4>ü§ñ Slave Arduino (3x)</h4>
                        <p>Membaca sensor analog, button, counter interrupt, dan merespon command dari master</p>
                    </div>
                
                <div class="info-box">
                    <p><strong>Total: 6 bytes</strong></p>
                    <p>Digunakan untuk CMD_READ_SENSOR (Analog 10-bit, dikemas dalam 2 bytes)</p>
                </div>
                
                <h3>üìä Contoh Paket Lengkap</h3>
                
                <div class="code-block">
<span class="comment">// === REQUEST: Read Analog dari Slave 2 ===</span>
Master kirim: [<span class="number">0xFF</span>, <span class="number">0xFE</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x00</span>]
              |SYNC1| |SYNC2| |ID=2| |CMD=2| |CS=2^2|

<span class="comment">// === RESPONSE: Analog value = 512 (0x0200) ===</span>
Slave kirim:  [<span class="number">0xFF</span>, <span class="number">0xFE</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>]
              |SYNC1| |SYNC2| |ID=2| |HIGH| |LOW | |CS=2^2^0|
</div>
            </div>
            
            <!-- Slide 4: State Machine -->
            <div class="slide">
                <h2>üîÑ State Machine Slave (ISR)</h2>
                
                <div class="info-box">
                    <h3>üéØ Mengapa State Machine?</h3>
                    <p>Slave menggunakan <strong>Interrupt Service Routine (ISR)</strong> untuk menangani setiap byte yang diterima dari SPI. State machine memastikan slave dapat:</p>
                    <ul>
                        <li>Parsing paket secara sequential byte-per-byte</li>
                        <li>Validasi sync pattern dan checksum</li>
                        <li>Mengirim response yang tepat</li>
                        <li>Reset state jika SS pin deasserted</li>
                    </ul>
                </div>
                
                <h3>üîÄ State Diagram</h3>
                
                <div class="state-machine">
                    <div class="state">
                        WAIT_SYNC1<br>
                        <small>Tunggu 0xFF</small>
                    </div>
                    <div class="state">
                        WAIT_SYNC2<br>
                        <small>Tunggu 0xFE</small>
                    </div>
                    <div class="state">
                        WAIT_ID<br>
                        <small>Cek Slave ID</small>
                    </div>
                    <div class="state">
                        WAIT_CMD<br>
                        <small>Terima Command</small>
                    </div>
                    <div class="state">
                        WAIT_CHECKSUM<br>
                        <small>Validasi Checksum</small>
                    </div>
                    <div class="state">
                        SEND_RESPONSE<br>
                        <small>Kirim Data</small>
                    </div>
                </div>
                
                <h3>üìù Detail Setiap State</h3>
                
                <table class="protocol-table">
                    <tr>
                        <th>State</th>
                        <th>Kondisi Next</th>
                        <th>Action</th>
                    </tr>
                    <tr>
                        <td><strong>WAIT_SYNC1</strong></td>
                        <td>Receive == 0xFF</td>
                        <td>‚Üí WAIT_SYNC2, Load 0x00 to SPDR</td>
                    </tr>
                    <tr>
                        <td><strong>WAIT_SYNC2</strong></td>
                        <td>Receive == 0xFE</td>
                        <td>‚Üí WAIT_ID, Load 0x00 to SPDR</td>
                    </tr>
                    <tr>
                        <td><strong>WAIT_ID</strong></td>
                        <td>Receive == SLAVE_ID</td>
                        <td>‚Üí WAIT_CMD, Store ID, Load 0x00</td>
                    </tr>
                    <tr>
                        <td><strong>WAIT_CMD</strong></td>
                        <td>Always</td>
                        <td>‚Üí WAIT_CHECKSUM, Store CMD, Load 0x00</td>
                    </tr>
                    <tr>
                        <td><strong>WAIT_CHECKSUM</strong></td>
                        <td>Checksum Valid</td>
                        <td>‚Üí SEND_RESPONSE, Prepare Response Buffer</td>
                    </tr>
                    <tr>
                        <td><strong>SEND_RESPONSE</strong></td>
                        <td>All bytes sent</td>
                        <td>‚Üí WAIT_SYNC1, Load next byte to SPDR</td>
                    </tr>
                </table>
                
                <h3>‚ö° Implementasi ISR</h3>
                
                <div class="code-block">
<span class="function">ISR</span>(<span class="string">SPI_STC_vect</span>) {
  <span class="comment">// Reset jika SS pin HIGH</span>
  <span class="keyword">if</span>(digitalRead(SS_PIN) == HIGH) {
    currentState = WAIT_SYNC1;
    responseReady = <span class="keyword">false</span>;
    responseIndex = <span class="number">0</span>;
    SPDR = <span class="number">0x00</span>;
    <span class="keyword">return</span>;
  }
  
  <span class="keyword">uint8_t</span> received = SPDR;
  <span class="keyword">uint8_t</span> toSend = <span class="number">0x00</span>;
  
  <span class="keyword">switch</span> (currentState) {
    <span class="keyword">case</span> WAIT_SYNC1:
      <span class="keyword">if</span> (received == SYNC1) {
        currentState = WAIT_SYNC2;
      }
      <span class="keyword">break</span>;
      
    <span class="keyword">case</span> WAIT_SYNC2:
      <span class="keyword">if</span> (received == SYNC2) {
        currentState = WAIT_ID;
      } <span class="keyword">else</span> {
        currentState = WAIT_SYNC1;
      }
      <span class="keyword">break</span>;
      
    <span class="keyword">case</span> WAIT_ID:
      receivedID = received;
      <span class="keyword">if</span> (receivedID == SLAVE_ID) {
        currentState = WAIT_CMD;
      } <span class="keyword">else</span> {
        currentState = WAIT_SYNC1;  <span class="comment">// Bukan untuk slave ini</span>
      }
      <span class="keyword">break</span>;
      
    <span class="keyword">case</span> WAIT_CMD:
      receivedCMD = received;
      currentState = WAIT_CHECKSUM;
      <span class="keyword">break</span>;
      
    <span class="keyword">case</span> WAIT_CHECKSUM:
      <span class="keyword">if</span> (received == (receivedID ^ receivedCMD)) {
        <span class="function">prepareResponse</span>(receivedCMD);  <span class="comment">// Siapkan data</span>
        currentState = SEND_RESPONSE;
        toSend = responseBuffer[<span class="number">0</span>];
      } <span class="keyword">else</span> {
        currentState = WAIT_SYNC1;  <span class="comment">// Checksum salah</span>
      }
      <span class="keyword">break</span>;
      
    <span class="keyword">case</span> SEND_RESPONSE:
      responseIndex++;
      <span class="keyword">if</span> (responseIndex < responseLength) {
        toSend = responseBuffer[responseIndex];
      } <span class="keyword">else</span> {
        currentState = WAIT_SYNC1;  <span class="comment">// Selesai</span>
      }
      <span class="keyword">break</span>;
  }
  
  SPDR = toSend;  <span class="comment">// Load byte untuk transfer berikutnya</span>
}
                </div>
                
                <h3>üì∏ Data Snapshot untuk Konsistensi</h3>
                
                <div class="info-box">
                    <p>Slave menggunakan <strong>snapshot mechanism</strong> untuk memastikan data yang dikirim konsisten:</p>
                    <div class="code-block">
<span class="keyword">void</span> <span class="function">prepareResponse</span>(<span class="keyword">uint8_t</span> cmd) {
  <span class="comment">// Ambil snapshot data dengan interrupt disabled</span>
  <span class="function">noInterrupts</span>();
  analogSnapshot = analogVal;
  cntSnapshot = cnt;
  pb2Snapshot = pb2 ? <span class="number">1</span> : <span class="number">0</span>;
  <span class="function">interrupts</span>();
  
  <span class="comment">// Build response packet berdasarkan command</span>
  <span class="comment">// ...</span>
}
                    </div>
                    <p>Ini mencegah data berubah di tengah-tengah proses pengiriman response</p>
                </div>
            </div>
            
            <!-- Slide 5: Alur Data -->
            <div class="slide">
                <h2>üîÄ Alur Data Lengkap: PC ‚Üí Master ‚Üí Slave</h2>
                
                <h3>üìç Skenario: PC Request Data Analog dari Slave 2</h3>
                
                <div class="diagram">
                    <h4 style="color: #1e3c72; margin-bottom: 20px;">Step-by-Step Flow</h4>
                    
                    <div style="text-align: left; max-width: 800px; margin: 0 auto;">
                        <div style="background: #fff3cd; padding: 15px; border-left: 5px solid #ffc107; margin: 10px 0; border-radius: 5px;">
                            <strong>1Ô∏è‚É£ PC ‚Üí Master (UART Serial)</strong><br>
                            PC mengirim: <code>"22"</code><br>
                            <small>‚Ä¢ Karakter '2' pertama = Slave ID 2</small><br>
                            <small>‚Ä¢ Karakter '2' kedua = Data Select 2 (Analog)</small>
                        </div>
                        
                        <div style="background: #d1ecf1; padding: 15px; border-left: 5px solid #17a2b8; margin: 10px 0; border-radius: 5px;">
                            <strong>2Ô∏è‚É£ Master Parse Command</strong><br>
                            <code>requestedSlave = 2</code><br>
                            <code>requestedData = 2</code><br>
                            <code>pcRequestActive = true</code><br>
                            <small>‚Ä¢ Master mengaktifkan mode streaming periodik (10ms interval)</small>
                        </div>
                        
                        <div style="background: #d4edda; padding: 15px; border-left: 5px solid #28a745; margin: 10px 0; border-radius: 5px;">
                            <strong>3Ô∏è‚É£ Master ‚Üí Slave 2 (SPI Request)</strong><br>
                            <code>digitalWrite(SS_SLAVE2, LOW)</code><br>
                            Master kirim: <code>[0xFF, 0xFE, 0x02, 0x02, 0x00]</code><br>
                            <small>‚Ä¢ SS_SLAVE2 (A14) di-assert LOW</small><br>
                            <small>‚Ä¢ Command: READ_SENSOR (0x02)</small><br>
                            <small>‚Ä¢ Checksum: 0x02 XOR 0x02 = 0x00</small>
                        </div>
                        
                        <div style="background: #f8d7da; padding: 15px; border-left: 5px solid #dc3545; margin: 10px 0; border-radius: 5px;">
                            <strong>4Ô∏è‚É£ Slave 2 Process (ISR State Machine)</strong><br>
                            <small>‚Ä¢ State: WAIT_SYNC1 ‚Üí ... ‚Üí WAIT_CHECKSUM</small><br>
                            <small>‚Ä¢ Validasi checksum berhasil</small><br>
                            <small>‚Ä¢ Ambil snapshot: analogSnapshot = 512</small><br>
                            <small>‚Ä¢ Build response: [0xFF, 0xFE, 0x02, 0x02, 0x00, 0x00]</small><br>
                            <small>‚Ä¢ State: SEND_RESPONSE</small>
                        </div>
                        
                        <div style="background: #d4edda; padding: 15px; border-left: 5px solid #28a745; margin: 10px 0; border-radius: 5px;">
                            <strong>5Ô∏è‚É£ Master Receive Response (SPI)</strong><br>
                            Master baca 15 bytes, cari sync pattern<br>
                            Dapat: <code>[0xFF, 0xFE, 0x02, 0x02, 0x00, 0x00]</code><br>
                            <small>‚Ä¢ Validasi: ID=0x02 ‚úì</small><br>
                            <small>‚Ä¢ Checksum: (0x02 XOR 0x02 XOR 0x00) = 0x00 ‚úì</small><br>
                            <small>‚Ä¢ Analog value = (0x02 << 8) | 0x00 = 512</small><br>
                            <code>digitalWrite(SS_SLAVE2, HIGH)</code>
                        </div>
                        
                        <div style="background: #d1ecf1; padding: 15px; border-left: 5px solid #17a2b8; margin: 10px 0; border-radius: 5px;">
                            <strong>6Ô∏è‚É£ Master Update Data Structure</strong><br>
                            <code>slave2Data.analog = 512</code><br>
                            <code>slave2Data.valid = true</code><br>
                            <small>‚Ä¢ Simpan ke EEPROM offset 4-7</small>
                        </div>
                        
                        <div style="background: #fff3cd; padding: 15px; border-left: 5px solid #ffc107; margin: 10px 0; border-radius: 5px;">
                            <strong>7Ô∏è‚É£ Master ‚Üí PC (UART Serial)</strong><br>
                            Serial print: <code>">>> 512"</code><br>
                            <small>‚Ä¢ Output sesuai requestedData (2 = Analog only)</small><br>
                            <small>‚Ä¢ Proses berulang setiap 10ms sampai PC kirim "STOP"</small>
                        </div>
                    </div>
                </div>
                
                <h3>‚è±Ô∏è Timing Diagram</h3>
                
                <div class="timing-diagram">
                    <div class="timeline">
                        <div class="timeline-label">PC ‚Üí Master</div>
                        <div class="timeline-bar">~1 ms (UART 115200)</div>
                    </div>
                    <div class="timeline">
                        <div class="timeline-label">Master Process</div>
                        <div class="timeline-bar">~0.1 ms</div>
                    </div>
                    <div class="timeline">
                        <div class="timeline-label">SPI Transaction</div>
                        <div class="timeline-bar">~0.5 ms (dengan delays)</div>
                    </div>
                    <div class="timeline">
                        <div class="timeline-label">Data Processing</div>
                        <div class="timeline-bar">~0.2 ms</div>
                    </div>
                    <div class="timeline">
                        <div class="timeline-label">Master ‚Üí PC</div>
                        <div class="timeline-bar">~1 ms (UART 115200)</div>
                    </div>
                    <div style="text-align: center; margin-top: 15px; font-weight: bold; color: #1e3c72;">
                        Total: ~2.8 ms per cycle
                    </div>
                    <div style="text-align: center; margin-top: 5px; color: #666;">
                        Repeat setiap 10 ms = ~357 samples/second
                    </div>
                </div>
                
                <h3>üîÑ Non-Blocking Architecture</h3>
                
                <div class="info-box">
                    <p><strong>Master menggunakan pendekatan non-blocking:</strong></p>
                    <ul>
                        <li><strong>LCD Update:</strong> Timer-based, 500ms interval</li>
                        <li><strong>PC Display:</strong> Timer-based, 10ms interval (fast streaming)</li>
                        <li><strong>Serial Check:</strong> Non-blocking <code>Serial.available()</code></li>
                        <li><strong>SPI Operations:</strong> Quick polling dengan minimal delay</li>
                    </ul>
                    <p>Semua task berjalan dalam <code>loop()</code> tanpa blocking <code>delay()</code> panjang</p>
                </div>
            </div>
            
            <!-- Slide 6: Command & Response -->
            <div class="slide">
                <h2>üí¨ Command & Response Detail</h2>
                
                <h3>1Ô∏è‚É£ Read PB2 Value (CMD 0x01)</h3>
                
                <div class="info-box">
                    <p><strong>Request:</strong></p>
                    <div class="packet-diagram">
                        <div class="packet-byte">
                            <div class="value">0xFF</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0xFE</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0x01</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0x01</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0x00</div>
                        </div>
                    </div>
                    
                    <p><strong>Response:</strong></p>
                    <div class="packet-diagram">
                        <div class="packet-byte">
                            <div class="value">0xFF</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0xFE</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0x01</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0/1</div>
                            <div class="label">PB2</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">CHK</div>
                        </div>
                    </div>
                    
                    <p><strong>Fungsi Slave:</strong></p>
                    <div class="code-block">
<span class="comment">// Toggle button pada pin A7</span>
<span class="keyword">bool</span> pb2 = <span class="keyword">false</span>;
<span class="keyword">int</span> readPB2 = (analogRead(A7) == <span class="number">0</span>) ? <span class="number">0</span> : <span class="number">1</span>;

<span class="keyword">if</span> (readPB2 != lastPB2 && millis() - lastDeb > <span class="number">50</span>) {
  <span class="keyword">if</span> (readPB2 == LOW) {
    pb2 = !pb2;  <span class="comment">// Toggle state</span>
  }
}
                    </div>
                </div>
                
                <h3>2Ô∏è‚É£ Read Analog Sensor (CMD 0x02)</h3>
                
                <div class="info-box">
                    <p><strong>Request:</strong></p>
                    <div class="packet-diagram">
                        <div class="packet-byte">
                            <div class="value">0xFF</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0xFE</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0x01</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0x02</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0x03</div>
                        </div>
                    </div>
                    
                    <p><strong>Response:</strong></p>
                    <div class="packet-diagram">
                        <div class="packet-byte">
                            <div class="value">0xFF</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0xFE</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0x01</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">HIGH</div>
                            <div class="label">Bit[15:8]</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">LOW</div>
                            <div class="label">Bit[7:0]</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">CHK</div>
                        </div>
                    </div>
                    
                    <p><strong>Fungsi Slave:</strong></p>
                    <div class="code-block">
<span class="comment">// Baca analog dari A0 (0-1023)</span>
analogVal = <span class="function">analogRead</span>(A0);

<span class="comment">// Logic: toggle pb1 jika analog 300-700 selama 1 detik</span>
<span class="keyword">if</span> (analogVal > <span class="number">300</span> && analogVal < <span class="number">700</span>) {
  <span class="keyword">if</span> (millis() - lastA0ToggleTime > <span class="number">1000</span>) {
    lastA0ToggleTime = millis();
    pb1 = !pb1;
  }
}
                    </div>
                </div>
                
                <h3>3Ô∏è‚É£ Read Counter (CMD 0x03)</h3>
                
                <div class="info-box">
                    <p><strong>Request:</strong></p>
                    <div class="packet-diagram">
                        <div class="packet-byte">
                            <div class="value">0xFF</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0xFE</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0x01</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0x03</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0x02</div>
                        </div>
                    </div>
                    
                    <p><strong>Response:</strong></p>
                    <div class="packet-diagram">
                        <div class="packet-byte">
                            <div class="value">0xFF</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0xFE</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0x01</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">0-255</div>
                            <div class="label">Counter</div>
                        </div>
                        <div class="packet-byte">
                            <div class="value">CHK</div>
                        </div>
                    </div>
                    
                    <p><strong>Fungsi Slave:</strong></p>
                    <div class="code-block">
<span class="comment">// Interrupt pada pin 3 (falling edge)</span>
<span class="keyword">volatile uint8_t</span> cnt = <span class="number">0</span>;

<span class="keyword">void</span> <span class="function">isrInt1</span>() {
  <span class="keyword">static unsigned long</span> last = <span class="number">0</span>;
  <span class="keyword">unsigned long</span> now = <span class="function">micros</span>();
  
  <span class="comment">// Debouncing 50ms</span>
  <span class="keyword">if</span> (now - last > <span class="number">50000</span>) {
    last = now;
    cnt++;  <span class="comment">// Increment counter</span>
  }
}

<span class="function">attachInterrupt</span>(<span class="function">digitalPinToInterrupt</span>(<span class="number">3</span>), isrInt1, FALLING);
                    </div>
                    
                    <p><strong>Auto LED Blink Logic:</strong></p>
                    <div class="code-block">
<span class="comment">// Jika counter > 5, blink LED 3x</span>
<span class="keyword">if</span> (cnt > <span class="number">5</span> && !blinking) {
  cnt = <span class="number">0</span>;
  blinking = <span class="keyword">true</span>;
  blinkCount = <span class="number">0</span>;
}
                    </div>
                </div>
                
                <h3>üîç Master Parsing Logic</h3>
                
                <div class="code-block">
<span class="comment">// Cari sync pattern dalam 15 bytes response</span>
<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < <span class="number">10</span>; i++) {
  <span class="keyword">if</span> (response[i] == SYNC1 && 
      response[i+<span class="number">1</span>] == SYNC2 && 
      response[i+<span class="number">2</span>] == slaveID) {
    
    <span class="comment">// Single byte data</span>
    <span class="keyword">uint8_t</span> data = response[i+<span class="number">3</span>];
    <span class="keyword">uint8_t</span> recvChecksum = response[i+<span class="number">4</span>];
    <span class="keyword">uint8_t</span> expectedChecksum = slaveID ^ data;
    
    <span class="keyword">if</span> (recvChecksum == expectedChecksum) {
      <span class="keyword">return</span> data;
    }
  }
}
                </div>
            </div>
            
            <!-- Slide 7: PC Interface -->
            <div class="slide">
                <h2>üñ•Ô∏è PC Interface & Control</h2>
                
                <h3>üìù Format Command PC</h3>
                
                <div class="info-box">
                    <p><strong>Command Format:</strong> <code>XY</code> (2 karakter)</p>
                    <ul>
                        <li><strong>X</strong> = Slave ID (1, 2, atau 3)</li>
                        <li><strong>Y</strong> = Data Select (1-7)</li>
                    </ul>
                    <p><strong>Special Command:</strong> <code>STOP</code> untuk menghentikan streaming</p>
                </div>
                
                <h3>üìä Data Select Options</h3>
                
                <table class="protocol-table">
                    <tr>
                        <th>Code</th>
                        <th>Output</th>
                        <th>Contoh Command</th>
                        <th>Contoh Output</th>
                    </tr>
                    <tr>
                        <td><strong>1</strong></td>
                        <td>PB2 only</td>
                        <td>11</td>
                        <td>>>> 1</td>
                    </tr>
                    <tr>
                        <td><strong>2</strong></td>
                        <td>ADC only</td>
                        <td>22</td>
                        <td>>>> 512</td>
                    </tr>
                    <tr>
                        <td><strong>3</strong></td>
                        <td>PB2 + ADC</td>
                        <td>13</td>
                        <td>>>> 1 512</td>
                    </tr>
                    <tr>
                        <td><strong>4</strong></td>
                        <td>Counter only</td>
                        <td>34</td>
                        <td>>>> 7</td>
                    </tr>
                    <tr>
                        <td><strong>5</strong></td>
                        <td>PB2 + Counter</td>
                        <td>25</td>
                        <td>>>> 0 7</td>
                    </tr>
                    <tr>
                        <td><strong>6</strong></td>
                        <td>ADC + Counter</td>
                        <td>16</td>
                        <td>>>> 512 7</td>
                    </tr>
                    <tr>
                        <td><strong>7</strong></td>
                        <td>ALL (PB2+ADC+CNT)</td>
                        <td>37</td>
                        <td>>>> 1 512 7</td>
                    </tr>
                </table>
                
                <h3>üíª Contoh Session
                
                <h3>üìä Data yang Dikelola</h3>
                <table class="protocol-table">
                    <tr>
                        <th>Jenis Data</th>
                        <th>Sumber</th>
                        <th>Ukuran</th>
                        <th>Keterangan</th>
                    </tr>
                    <tr>
                        <td><strong>PB2</strong></td>
                        <td>Pin A7 (Button)</td>
                        <td>1 byte</td>
                        <td>Status toggle button (0 atau 1)</td>
                    </tr>
                    <tr>
                        <td><strong>Analog</strong></td>
                        <td>Pin A0 (Sensor)</td>
                        <td>2 bytes</td>
                        <td>Nilai ADC 10-bit (0-1023)</td>
                    </tr>
                    <tr>
                        <td><strong>Counter</strong></td>
                        <td>Pin 3 (Interrupt)</td>
                        <td>1 byte</td>
                        <td>Hitungan interrupt event</td>
                    </tr>
                </table>
                
                <div class="info-box">
                    <h3>‚ö° Fitur Khusus</h3>
                    <ul>
                        <li><strong>Non-blocking Architecture:</strong> Semua operasi dirancang asynchronous untuk performa optimal</li>
                        <li><strong>Custom Protocol:</strong> Sync bytes, checksums, dan state machine untuk reliable communication</li>
                        <li><strong>Fast Polling:</strong> Update interval 10ms untuk real-time data streaming</li>
                        <li><strong>Data Persistence:</strong> Auto-save ke EEPROM untuk recovery</li>
                        <li><strong>LCD Display:</strong> Rotasi otomatis menampilkan status semua slave</li>
                    </ul>
                </div>
            </div>
            
            <!-- Slide 1: Arsitektur -->
            <div class="slide">
                <h2>üèóÔ∏è Arsitektur Sistem</h2>
                
                <div class="diagram">
                    <h3>Topologi Komunikasi</h3>
                    <div style="margin: 30px 0;">
                        <div class="flow-box box-pc">PC/Computer</div>
                        <div class="arrow">‚¨áÔ∏è</div>
                        <div style="font-size: 12px; color: #666; margin: 10px 0;">UART Serial (115200 baud)</div>
                        <div class="arrow">‚¨áÔ∏è</div>
                        <div class="flow-box box-master">Master Arduino</div>
                        <div class="arrow">‚¨áÔ∏è</div>
                        <div style="font-size: 12px; color: #666; margin: 10px 0;">SPI Bus</div>
                        <div class="arrow">‚¨áÔ∏è</div>
                        <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                            <div class="flow-box box-slave">Slave 1<br>(ID: 0x01)</div>
                            <div class="flow-box box-slave">Slave 2<br>(ID: 0x02)</div>
                            <div class="flow-box box-slave">Slave 3<br>(ID: 0x03)</div>
                        </div>
                    </div>
                </div>
                
                <h3>üîå Koneksi Hardware</h3>
                <table class="protocol-table">
                    <tr>
                        <th>Signal</th>
                        <th>Pin Master</th>
                        <th>Pin Slave</th>
                        <th>Fungsi</th>
                    </tr>
                    <tr>
                        <td><strong>MOSI</strong></td>
                        <td>51</td>
                        <td>11</td>
                        <td>Master Out Slave In - Data dari Master ke Slave</td>
                    </tr>
                    <tr>
                        <td><strong>MISO</strong></td>
                        <td>50</td>
                        <td>12</td>
                        <td>Master In Slave Out - Data dari Slave ke Master</td>
                    </tr>
                    <tr>
                        <td><strong>SCK</strong></td>
                        <td>52</td>
                        <td>13</td>
                        <td>Serial Clock - Clock signal dari Master</td>
                    </tr>
                    <tr>
                        <td><strong>SS1</strong></td>
                        <td>A13</td>
                        <td>2</td>
                        <td>Slave Select untuk Slave 1</td>
                    </tr>
                    <tr>
                        <td><strong>SS2</strong></td>
                        <td>A14</td>
                        <td>2</td>
                        <td>Slave Select untuk Slave 2</td>
                    </tr>
                    <tr>
                        <td><strong>SS3</strong></td>
                        <td>A15</td>
                        <td>2</td>
                        <td>Slave Select untuk Slave 3</td>
                    </tr>
                </table>
                
                <h3>üì° Komunikasi UART (PC ‚Üî Master)</h3>
                <div class="info-box">
                    <ul>
                        <li><strong>Baud Rate:</strong> 115200 bps (high speed untuk real-time data)</li>
                        <li><strong>Format Command:</strong> 2 karakter ASCII (XY)</li>
                        <li><strong>Data Flow:</strong> PC mengirim command ‚Üí Master merespon dengan data stream</li>
                        <li><strong>Kontrol:</strong> Command "STOP" untuk menghentikan streaming</li>
                    </ul>
                </div>
                
                <h3>üîÑ Komunikasi SPI (Master ‚Üî Slave)</h3>
                <div class="info-box">
                    <ul>
                        <li><strong>Mode:</strong> SPI Mode 0 (CPOL=0, CPHA=0)</li>
                        <li><strong>Clock Speed:</strong> SPI_CLOCK_DIV8 (2 MHz pada 16 MHz Arduino)</li>
                        <li><strong>Bit Order:</strong> MSB First</li>
                        <li><strong>Full Duplex:</strong> Simultaneous transmit dan receive</li>
                        <li><strong>Slave Selection:</strong> Active LOW pada SS pin</li>
                    </ul>
                </div>
            </div>
            
            <!-- Slide 2: Protocol SPI -->
            <div class="slide">
                <h2>üì° Protocol SPI Custom</h2>
                
                <div class="info-box">
                    <h3>üéØ Mengapa Custom Protocol?</h3>
                    <p>SPI hardware hanya menyediakan <strong>byte-level transfer</strong>. Untuk komunikasi yang reliable, kita membutuhkan:</p>
                    <ul>
                        <li><strong>Synchronization:</strong> Identifikasi awal dan akhir paket</li>
                        <li><strong>Addressing:</strong> Identifikasi slave mana yang dituju</li>
                        <li><strong>Error Detection:</strong> Verifikasi integritas data</li>
                        <li><strong>Command Structure:</strong> Jenis data yang diminta</li>
                    </ul>
                </div>
                
                <h3>üîê Komponen Protocol</h3>
                
                <table class="protocol-table">
                    <tr>
                        <th>Komponen</th>
                        <th>Nilai</th>
                        <th>Fungsi</th>
                    </tr>
                    <tr>
                        <td><strong>SYNC1</strong></td>
                        <td>0xFF</td>
                        <td>Byte pertama untuk sync pattern</td>
                    </tr>
                    <tr>
                        <td><strong>SYNC2</strong></td>
                        <td>0xFE</td>
                        <td>Byte kedua untuk sync pattern</td>
                    </tr>
                    <tr>
                        <td><strong>Slave ID</strong></td>
                        <td>0x01, 0x02, 0x03</td>
                        <td>Identifikasi slave yang dituju</td>
                    </tr>
                    <tr>
                        <td><strong>Command</strong></td>
                        <td>0x01, 0x02, 0x03</td>
                        <td>Jenis data yang diminta</td>
                    </tr>
                    <tr>
                        <td><strong>Checksum</strong></td>
                        <td>ID XOR CMD (XOR data)</td>
                        <td>Verifikasi integritas paket</td>
                    </tr>
                </table>
                
                <h3>üìù Daftar Command</h3>
                
                <div class="code-block">
<span class="keyword">#define</span> CMD_READ_VALUE   <span class="number">0x01</span>  <span class="comment">// Baca PB2 (1 byte)</span>
<span class="keyword">#define</span> CMD_READ_SENSOR  <span class="number">0x02</span>  <span class="comment">// Baca Analog (2 bytes)</span>
<span class="keyword">#define</span> CMD_READ_COUNTER <span class="number">0x03</span>  <span class="comment">// Baca Counter (1 byte)</span>
                </div>
                
                <h3>‚úÖ Mekanisme Checksum</h3>
                
                <div class="info-box">
                    <p><strong>Request Checksum:</strong></p>
                    <div class="code-block">
checksum = Slave_ID <span class="keyword">XOR</span> Command
<span class="comment">// Contoh: Slave 1, CMD_READ_SENSOR</span>
checksum = <span class="number">0x01</span> <span class="keyword">XOR</span> <span class="number">0x02</span> = <span class="number">0x03</span>
                    </div>
                    
                    <p style="margin-top: 20px;"><strong>Response Checksum (1 byte data):</strong></p>
                    <div class="code-block">
checksum = Slave_ID <span class="keyword">XOR</span> Data
<span class="comment">// Contoh: Slave 1, PB2=1</span>
checksum = <span class="number">0x01</span> <span class="keyword">XOR</span> <span class="number">0x01</span> = <span class="number">0x00</span>
                    </div>
                    
                    <p style="margin-top: 20px;"><strong>Response Checksum (2 bytes data):</strong></p>
                    <div class="code-block">
checksum = Slave_ID <span class="keyword">XOR</span> Data_High <span class="keyword">XOR</span> Data_Low
<span class="comment">// Contoh: Slave 1, Analog=512 (0x0200)</span>
checksum = <span class="number">0x01</span> <span class="keyword">XOR</span> <span class="number">0x02</span> <span class="keyword">XOR</span> <span class="number">0x00</span> = <span class="number">0x03</span>
                    </div>
                </div>
                
                <h3>üîÑ SPI Timing</h3>
                
                <div class="timing-diagram">
                    <div class="timeline">
                        <div class="timeline-label">SS Assert</div>
                        <div class="timeline-bar">20 Œºs</div>
                    </div>
                    <div class="timeline">
                        <div class="timeline-label">Byte Transfer</div>
                        <div class="timeline-bar">10 Œºs delay</div>
                    </div>
                    <div class="timeline">
                        <div class="timeline-label">Command Wait</div>
                        <div class="timeline-bar">50 Œºs</div>
                    </div>
                    <div class="timeline">
                        <div class="timeline-label">Response Read</div>
                        <div class="timeline-bar">15 bytes √ó 10 Œºs</div>
                    </div>
                    <div class="timeline">
                        <div class="timeline-label">SS Deassert</div>
                        <div class="timeline-bar">End</div>
                    </div>
                </div>
            </div>
            
            <!-- Slide 3: Format Paket -->
            <div class="slide">
                <h2>üì¶ Format Paket Request & Response</h2>
                
                <h3>üì§ Request Packet (Master ‚Üí Slave)</h3>
                
                <div class="packet-diagram">
                    <div class="packet-byte">
                        <div class="label">Byte 0</div>
                        <div class="value">0xFF</div>
                        <div class="label">SYNC1</div>
                    </div>
                    <div class="packet-byte">
                        <div class="label">Byte 1</div>
                        <div class="value">0xFE</div>
                        <div class="label">SYNC2</div>
                    </div>
                    <div class="packet-byte">
                        <div class="label">Byte 2</div>
                        <div class="value">0x01-0x03</div>
                        <div class="label">Slave ID</div>
                    </div>
                    <div class="packet-byte">
                        <div class="label">Byte 3</div>
                        <div class="value">0x01-0x03</div>
                        <div class="label">Command</div>
                    </div>
                    <div class="packet-byte">
                        <div class="label">Byte 4</div>
                        <div class="value">ID^CMD</div>
                        <div class="label">Checksum</div>
                    </div>
                </div>
                
                <div class="info-box">
                    <p><strong>Total: 5 bytes</strong></p>
                    <p>Setelah mengirim request, master langsung membaca 15 bytes untuk mencari response pattern</p>
                </div>
                
                <h3>üì• Response Packet Type 1: Single Byte (PB2 / Counter)</h3>
                
                <div class="packet-diagram">
                    <div class="packet-byte">
                        <div class="label">Byte 0</div>
                        <div class="value">0xFF</div>
                        <div class="label">SYNC1</div>
                    </div>
                    <div class="packet-byte">
                        <div class="label">Byte 1</div>
                        <div class="value">0xFE</div>
                        <div class="label">SYNC2</div>
                    </div>
                    <div class="packet-byte">
                        <div class="label">Byte 2</div>
                        <div class="value">0x01-0x03</div>
                        <div class="label">Slave ID</div>
                    </div>
                    <div class="packet-byte">
                        <div class="label">Byte 3</div>
                        <div class="value">Data</div>
                        <div class="label">Value</div>
                    </div>
                    <div class="packet-byte">
                        <div class="label">Byte 4</div>
                        <div class="value">ID^Data</div>
                        <div class="label">Checksum</div>
                    </div>
                </div>
                
                <div class="info-box">
                    <p><strong>Total: 5 bytes</strong></p>
                    <p>Digunakan untuk CMD_READ_VALUE (PB2) dan CMD_READ_COUNTER</p>
                </div>
                
                <h3>üì• Response Packet Type 2: Double Byte (Analog Sensor)</h3>
                
                <div class="packet-diagram">
                    <div class="packet-byte">
                        <div class="label">Byte 0</div>
                        <div class="value">0xFF</div>
                        <div class="label">SYNC1</div>
                    </div>
                    <div class="packet-byte">
                        <div class="label">Byte 1</div>
                        <div class="value">0xFE</div>
                        <div class="label">SYNC2</div>
                    </div>
                    <div class="packet-byte">
                        <div class="label">Byte 2</div>
                        <div class="value">0x01-0x03</div>
                        <div class="label">Slave ID</div>
                    </div>
                    <div class="packet-byte">
                        <div class="label">Byte 3</div>
                        <div class="value">High</div>
                        <div class="label">ADC[15:8]</div>
                    </div>
                    <div class="packet-byte">
                        <div class="label">Byte 4</div>
                        <div class="value">Low</div>
                        <div class="label">ADC[7:0]</div>
                    </div>
                    <div class="packet-byte">
                        <div class="label">Byte 5</div>
                        <div class="value">ID^H^L</div>
                        <div class="label">Checksum</div>
                    </div>
                </div>
